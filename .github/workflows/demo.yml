name: send secret
on:
  push:
    branches:
      - main
  workflow_dispatch:
  pull_request:
    branches:
      - main

jobs:
  demo_secret:
    name: Demo of secrets
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repo
        uses: actions/checkout@v5

      - name: Verify secret
        run: |
          if [ -z "${{ secrets.FAVORITE_NUMBER }}" ]; then
            echo "âš ï¸  WARNING: Secret 'FAVORITE_NUMBER' is not configured"
            echo ""
            echo "To set up this secret:"
            echo "1. Go to your repository on GitHub"
            echo "2. Click Settings â†’ Secrets and variables â†’ Actions"
            echo "3. Click 'New repository secret'"
            echo "4. Name: FAVORITE_NUMBER"
            echo "6. Click 'Add secret'"
            echo ""
            echo "This workflow will continue but skip the notification step."
          else
            echo "âœ… Secret 'FAVORITE_NUMBER' is configured"
          fi

      - name: Print secret
        run: |
          echo "=========================================================="
          echo "              Github actions Secrets demo"
          echo "=========================================================="
          echo ""
          echo " This workflow demos how to use secrets in Github Actions"
          echo "=========================================================="

          echo "The secret number is: ${{ secrets.FAVORITE_NUMBER }}"

      - name: Verify Discord webhook
        id: check_discord
        run: |
          if [ -z "${{ secrets.DISCORD_WEBHOOK }}" ]; then
            echo "âš ï¸  WARNING: Secret 'DISCORD_WEBHOOK' is not configured"
            echo ""
            echo "To set up this secret:"
            echo "1. Go to your repository on GitHub"
            echo "2. Click Settings â†’ Secrets and variables â†’ Actions"
            echo "3. Click 'New repository secret'"
            echo "4. Name: DISCORD_WEBHOOK"
            echo "5. Value: Your Discord webhook URL"
            echo "6. Click 'Add secret'"
            echo ""
            echo "Skipping Discord notification."
            echo "discord_configured=false" >> $GITHUB_OUTPUT
          else
            echo "âœ… Secret 'DISCORD_WEBHOOK' is configured"
            echo "discord_configured=true" >> $GITHUB_OUTPUT
          fi

      - name: Send message to Discord
        if: steps.check_discord.outputs.discord_configured == 'true'
        run: |
          curl -H "Content-Type: application/json" \
            -X POST \
          -d '{"content": "ðŸš€ Iron dev message from: ${{ github.actor }}"}' \
            ${{ secrets.DISCORD_WEBHOOK }}
